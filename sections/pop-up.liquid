<div class="popup">
  {% render 'responsive-picture'
    , desktopImage: section.settings.image_desktop
    , mobileImage: section.settings.image_mobile
  %}
  <div class="card"></div>
</div>

<div id="popupContainer" class="popup-container">
  <div class="popup-content">
    <div class="content">
      <div>
        <!-- Close button -->
        <span class="close-btn" onclick="closePopup()">&times;</span>
        <!-- Heading -->
        <h2>Subscribe to our Newsletter and Get 10% off for your next purchase</h2>
        <!-- Paragraph -->
        <p>Subscribe to our Newsletter and Get 10% off for your next purchase. Stay updated on our latest products and promotions.</p>
        <!-- Form -->
        <form id="subscribeForm" onsubmit="submitForm(event)">
          <input
            type="email"
            id="emailInput"
            placeholder="Enter your email"
            required>
          <button type="submit">Subscribe</button>
        </form>
        <div class="terms">
          <p>By subscribing you agree to our
            <a href="">terms</a>
            and
            <a href="">conditions.</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .popup-container {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
  }

  .popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    max-width: 400px;
    width: 100%;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }
  .content {
    display: flex;
  }
  .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    cursor: pointer;
  }

  #subscribeForm {
    margin-top: 20px;
    margin-right: 20px;
  }

  #subscribeForm input[type="email"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
  }

  #subscribeForm button {
    padding: 10px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }

  #subscribeForm button:hover {
    background-color: #0056b3;
  }
</style>

<script>
  let shouldShowPopup = true; // Flag to track if the popup should be shown initially
  
  document.addEventListener("DOMContentLoaded", function() {
  setTimeout(()=>
  {
    const subscribedEmail = localStorage.getItem('subscribedEmail');
   if (shouldShowPopup && !subscribedEmail) {
    openPopup();
   }
  },3000);
  });
  
  function openPopup() {
  document.getElementById('popupContainer').style.display = 'flex';
  }
  
  function closePopup() {
  document.getElementById('popupContainer').style.display = 'none';
  shouldShowPopup = false; // Update the flag when the popup is closed by the user
  setTimeout(() => {
    shouldShowPopup = true;
    openPopup() // Set the flag to true after a delay
  }, 3000); // 5000 milliseconds (5 seconds) delay before the popup can appear again
  }
  
  function submitForm(event) {
  event.preventDefault(); // Prevent form from submitting
  
  // Get the email input value
  const email = document.getElementById('emailInput').value;
  
  // You can add further validation here before submitting the form
  const subscribedEmail = localStorage.getItem('subscribedEmail');
  if (subscribedEmail && subscribedEmail === email) {
    console.log('Email already subscribed:', email);
    closePopup(); // Close the popup if the email is already subscribed
    return;
  }
  // For demonstration purposes, let's log the email value
  localStorage.setItem('subscribedEmail', email);

  // For demonstration purposes, let's log the email value
  console.log('Email submitted and stored:', email);
  
  // Close the popup after form submission
  document.getElementById('popupContainer').style.display = 'none';
  }
</script>


{% schema %}
  {
    "name": "Popup section",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Background Image"
      }, {
        "type": "image_picker",
        "id": "image_desktop",
        "label": "Desktop image",
        "info": "Recommended dimensions: 1440 x 600"
      }, {
        "type": "image_picker",
        "id": "image_mobile",
        "label": "Mobile image",
        "info": "Recommended dimensions: 600 x 400"
      }
    ],
    "blocks": [],
    "presets": [
      {
        "name": "Popup Section"
      }
    ]
  }
{% endschema %}